{{- define "main" }}
<article class="post-single">
    <header class="post-header">
        <h1 class="post-title">Add Note</h1>
    </header>

    <div class="post-content">
        <form id="noteForm">
            <div style="margin-bottom: 15px;">
                <label for="title" style="display: block; margin-bottom: 5px;">Title:</label>
                <input type="text" id="title" required placeholder="Note Title"
                    style="width: 100%; padding: 8px; background: var(--entry); color: var(--primary); border: 1px solid var(--border); border-radius: 4px;">
            </div>

            <div style="margin-bottom: 15px;">
                <label for="content" style="display: block; margin-bottom: 5px;">Content:</label>
                <textarea id="content" rows="12" required placeholder="Write your markdown here..."
                    style="width: 100%; padding: 8px; background: var(--entry); color: var(--primary); border: 1px solid var(--border); font-family: monospace; border-radius: 4px;"></textarea>
            </div>

            <button type="submit"
                style="padding: 10px 20px; background: var(--primary); color: var(--theme); border: none; cursor: pointer; font-weight: bold; border-radius: 4px;">
                Download Markdown
            </button>
        </form>

        <div id="result"
            style="margin-top: 15px; padding: 15px; display: none; border-radius: 4px; border: 1px dashed var(--border);">
        </div>
    </div>
</article>

<script>
    document.getElementById('noteForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const title = document.getElementById('title').value;
        const content = document.getElementById('content').value;
        const date = new Date().toISOString().split('T')[0];
        // Generate slug from title
        const slug = title.toLowerCase()
            .trim()
            .replace(/[^a-z0-9 -]/g, '')
            .replace(/\s+/g, '-')
            .replace(/-+/g, '-');

        // Escape double quotes in the title for YAML safety
        const safeTitle = title.replace(/"/g, '\\"');

        const md = `---
title: "${safeTitle}"
date: ${date}
---

${content}`;

        const blob = new Blob([md], { type: 'text/markdown' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${slug}.md`;
        a.click();
        URL.revokeObjectURL(url);

        const resultDiv = document.getElementById('result');
        resultDiv.style.display = 'block';
        resultDiv.style.background = 'var(--code-bg)';
        resultDiv.innerHTML = `
            <p style="margin: 0; color: var(--primary);">âœ“ <strong>File generated:</strong> <code>${slug}.md</code></p>
            <small style="color: var(--secondary);">Move this file to your <code>content/notes/</code> folder.</small>
        `;
        this.reset();
    });
</script>
{{- end }}