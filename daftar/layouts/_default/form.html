{{- define "main" }}
<style>
    .form-group {
        margin-bottom: 1.5rem;
    }

    label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: bold;
    }

    input,
    textarea {
        padding: 8px 12px;
        width: 100%;
        color: var(--primary);
        border: 2px solid var(--tertiary);
        border-radius: var(--radius);
    }

    input:focus,
    textarea:focus {
        border-color: var(--secondary);
    }
</style>

<article class="post-single">
    <header class="post-header">
        <h1 class="post-title">Add Note</h1>
    </header>

    <div class="post-content">
        <form id="noteForm">
            <div class="form-group">
                <label for="title">Title:</label>
                <input type="text" id="title" required placeholder="Note Title">
            </div>

            <div class="form-group">
                <label for="content">Content:</label>
                <textarea id="content" rows="12" required placeholder="Write your note here..."></textarea>
            </div>

            <button type="submit" class="button"><span class="button-inner">Save Note</span></button>
        </form>

        <div id="result"
            style="display: none; margin-top: 1.5rem; padding: 1rem; background: var(--code-bg); border-radius: var(--radius); border: 1px solid var(--border);">
        </div>
    </div>
</article>

<script>
    const API_URL = '{{ getenv "HUGO_PARAMS_API_URL" }}';

    document.getElementById('noteForm').addEventListener('submit', async function (e) {
        e.preventDefault();

        const title = document.getElementById('title').value.trim();
        const content = document.getElementById('content').value.trim();
        const resultDiv = document.getElementById('result');

        resultDiv.style.display = 'block';
        resultDiv.innerHTML = '<small style="color: var(--secondary);">⏳ Saving note...</small>';

        try {
            const response = await fetch(`${API_URL}/notes`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ title, content })
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();

            resultDiv.innerHTML = `✓ <strong>Note saved successfully!</strong><br>
                <small style="color: var(--secondary);">Created at: ${new Date(data.created_at).toLocaleString()}</small><br>
                <a href="/notes/" class="button" style="display: inline-block; margin-top: 0.5rem;"><span class="button-inner">View all notes</span></a>`;

            this.reset();
        } catch (error) {
            resultDiv.innerHTML = `✗ <strong>Error:</strong> ${error.message}<br>
                <small style="color: var(--secondary);">Make sure the backend server is running on ${API_URL}</small>`;
        }
    });
</script>
{{- end }}